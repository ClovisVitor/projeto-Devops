<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Aplicação To-Do</title>
</head>
<body>
    <div class="container">
        <h1>Minhas Tarefas (To-Do List)</h1>

        <!-- Formulário para enviar nova tarefa -->
        <form id="addTaskForm">
            <label for="taskTitle">Título da Nova Tarefa:</label>
            <input type="text" id="taskTitle" placeholder="Digite a sua tarefa aqui" required>
            <button type="submit">Adicionar Tarefa</button>
        </form>

        <hr>

        <h2>Tarefas Atuais:</h2>
        <ul id="taskList">
            <li>Carregando...</li>
        </ul>
    </div>

    <!-- Script para consumir a API -->
    <script>
        const API_URL = "http://127.0.0.1:5000";

        // Função GET – Carrega todas as tarefas
        async function carregarTarefas() {
            try {
                const response = await fetch(`${API_URL}/tasks`);
                const tarefas = await response.json();

                const lista = document.getElementById("taskList");
                lista.innerHTML = "";  // limpa a lista antiga

                tarefas.forEach(task => {
                    const li = document.createElement("li");

                    li.innerHTML = `
                        <span style="text-decoration: ${task.done ? 'line-through' : 'none'};">
                            ${task.title}
                        </span>

                        <button onclick="marcarConcluida(${task.id}, ${task.done})">
                            ${task.done ? 'Desmarcar' : 'Concluir'}
                        </button>

                        <button onclick="deletarTask(${task.id})" style="margin-left: 10px; color: white; background-color: red;">
                        Excluir
                        </button>
                    `;
                    lista.appendChild(li);
                });

            } catch (error) {
                console.error("Erro ao carregar tarefas:", error);
            }
        }

        // Função POST – Adiciona nova tarefa
        document.getElementById("addTaskForm").addEventListener("submit", async (event) => {
            event.preventDefault();

            const titulo = document.getElementById("taskTitle").value;

            try {
                await fetch(`${API_URL}/tasks`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ title: titulo })
                });

                document.getElementById("taskTitle").value = "";

                // Recarrega lista
                carregarTarefas();

            } catch (error) {
                console.error("Erro ao adicionar tarefa:", error);
            }
        });

        // Atualizar tarefa (PUT)
        async function marcarConcluida(id, statusAtual) {
            try {
                await fetch(`${API_URL}/tasks/${id}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ done: !statusAtual })  // alterna
                });

                carregarTarefas();

            } catch (erro) {
                console.error("Erro ao atualizar tarefa:", erro);
            }
        }

        // Função DELETE 
        async function deletarTask(id) {
            try {
                const response = await fetch(`http://127.0.0.1:5000/tasks/${id}`, {
                    method: "DELETE"
                });

                if (!response.ok) {
                    throw new Error("Erro ao deletar task.");
                }

                carregarTarefas();

            } catch (error) {
                console.error("Erro ao deletar:", error);
            }
        }

        // Carrega tarefas ao abrir a página
        carregarTarefas();
    </script>
</body>
</html>